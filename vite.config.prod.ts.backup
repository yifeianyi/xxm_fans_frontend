import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// 生产环境配置 - 解决微信浏览器缓存问题
export default defineConfig({
    plugins: [react()],
    build: {
        // 启用文件名哈希，确保每次构建的文件名唯一
        rollupOptions: {
            output: {
                // JS 文件名格式：assets/[name]-[hash].js
                // 例如：assets/index-abc123def.js
                entryFileNames: 'assets/[name]-[hash].js',
                // 分包文件名格式：assets/[name]-[hash].js
                chunkFileNames: 'assets/[name]-[hash].js',
                // 资源文件名格式：assets/[name]-[hash].[extname]
                // 例如：assets/logo-xyz789.png
                assetFileNames: 'assets/[name]-[hash].[extname]'
            }
        },
        // 设置 chunk 大小警告阈值（1000KB）
        chunkSizeWarningLimit: 1000,
        // 启用 CSS 代码分割
        cssCodeSplit: true,
        // 压缩输出
        minify: 'terser',
        terserOptions: {
            compress: {
                // 生产环境移除 console
                drop_console: true,
                // 生产环境移除 debugger
                drop_debugger: true
            }
        },
        // 生成 sourcemap（可选，用于生产环境调试）
        // sourcemap: false,
        // 目标浏览器
        target: 'es2015'
    }
})