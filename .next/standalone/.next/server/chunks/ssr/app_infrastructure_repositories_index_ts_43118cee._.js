module.exports=[83209,47686,44321,a=>{"use strict";class b extends Error{status;code;constructor(a,b,c){super(b),this.status=a,this.code=c,this.name="ApiError"}}class c{baseURL;constructor(a){this.baseURL=a||process.env.INTERNAL_API_BASE_URL||process.env.API_BASE_URL||process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000/api"}async request(a,c){try{let d=this.baseURL.endsWith("/")?this.baseURL:`${this.baseURL}/`,e=a.startsWith("/")?a.slice(1):a,f=`${d}${e}`,g=await fetch(f,{...c,headers:{"Content-Type":"application/json",...c?.headers}});if(!g.ok)throw new b(g.status,`Request failed: ${g.statusText}`);let h=await g.json();if(h&&"object"==typeof h&&"code"in h)if(200===h.code)return{data:h.data};else throw new b(h.code,h.message||"Request failed");return{data:h}}catch(a){if(a instanceof b)return{error:a};return{error:new b(500,"Network error")}}}async get(a){return this.request(a,{method:"GET"})}async post(a,b){return this.request(a,{method:"POST",body:JSON.stringify(b)})}async put(a,b){return this.request(a,{method:"PUT",body:JSON.stringify(b)})}async delete(a){return this.request(a,{method:"DELETE"})}}function d(a){if(!a)return"";if(a.startsWith("http://")||a.startsWith("https://"))return a;let b=a.startsWith("/")?a:`/${a}`,c=(process.env.INTERNAL_API_BASE_URL||process.env.API_BASE_URL||process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000/api").replace(/\/api\/?$/,"");return`${c}${b}`}class e{static fromBackend(a){return{id:a.id?.toString()||"",name:a.song_name||"未知歌曲",originalArtist:a.singer||"未知歌手",genres:Array.isArray(a.styles)?a.styles:[],languages:a.language?[a.language]:[],firstPerformance:a.first_perform||"",lastPerformance:a.last_performed||a.last_perform||"",performanceCount:a.perform_count||0,tags:Array.isArray(a.tags)?a.tags:[]}}static fromBackendList(a){return Array.isArray(a)?a.map(a=>this.fromBackend(a)):(console.warn("SongMapper.fromBackendList: expected array, got",typeof a),[])}static recordFromBackend(a,b){let c=a.cover_url||a.cover||"";return{id:a.id?.toString()||"",songId:b,songName:a.song_name||"",date:a.performed_at||"",cover:d(c),coverThumbnailUrl:d(a.cover_thumbnail_url||c),note:a.notes||a.note||"",videoUrl:a.url||a.video_url||""}}static recordListFromBackend(a,b){return Array.isArray(a)?a.map(a=>this.recordFromBackend(a,b)):(console.warn("SongMapper.recordListFromBackend: expected array, got",typeof a),[])}static originalWorkFromBackend(a){return{title:a.title||"",date:a.date||"",desc:a.desc||"",cover:d(a.cover),songId:a.songId||a.song_id||"",neteaseId:a.neteaseId||a.netease_id||"",bilibiliBvid:a.bilibiliBvid||a.bilibili_bvid||a.bvid||"",featured:a.featured||!1}}static originalWorkListFromBackend(a){return Array.isArray(a)?a.map(a=>this.originalWorkFromBackend(a)):(console.warn("SongMapper.originalWorkListFromBackend: expected array, got",typeof a),[])}static recommendationFromBackend(a){let b=Array.isArray(a)?a.find(a=>a.is_active)||a[0]:a;if(!b)return{content:"",recommendedSongs:[],recommendedSongsDetails:[]};let c=b.recommended_songs_details?.map(a=>({id:a.id?.toString()||"",name:a.song_name||"未知歌曲",singer:a.singer||"未知歌手",language:a.language||"未知语种"}))||[];return{content:b.content||"",recommendedSongs:b.recommended_songs?.map(a=>a.id?.toString()||"")||[],recommendedSongsDetails:c}}static mapSortField(a){return({count:"perform_count",first:"first_perform",last:"last_performed",name:"song_name",artist:"singer"})[a]||a}static buildOrderingParam(a,b){let c=this.mapSortField(a);return"asc"===b?c:`-${c}`}}new class{apiClient;constructor(a){this.apiClient=a||new c}buildQueryParams(a){let b=new URLSearchParams;return a.q&&b.set("q",a.q),a.page&&b.set("page",a.page.toString()),a.limit&&b.set("limit",a.limit.toString()),a.ordering&&b.set("ordering",a.ordering),a.styles&&b.set("styles",a.styles),a.tags&&b.set("tags",a.tags),a.language&&b.set("language",a.language),b}async getSongs(a={}){let b=this.buildQueryParams(a),c=await this.apiClient.get(`/songs/?${b.toString()}`);if(c.error)throw c.error;let d=c.data,f=e.fromBackendList(d.results||[]);return{total:d.total||f.length,page:d.page||a.page||1,page_size:d.page_size||a.limit||20,results:f}}async getSongById(a){let b=await this.apiClient.get(`/songs/${a}/`);if(b.error)throw b.error;return e.fromBackend(b.data)}async getRecords(a,b){let c,d,f=new URLSearchParams;b?.page&&f.set("page",b.page.toString()),b?.page_size&&f.set("page_size",b.page_size.toString());let g=await this.apiClient.get(`/songs/${a}/records/?${f.toString()}`);if(g.error)throw g.error;let h=g.data;if(Array.isArray(h))c=h,d=h.length;else{if(!(h.results&&Array.isArray(h.results)))return console.warn("SongRepository.getRecords: unexpected data format",h),{results:[],total:0,page:1,page_size:10};c=h.results,d=h.total||h.results.length}return{results:e.recordListFromBackend(c,a),total:d,page:h.page||1,page_size:h.page_size||10}}async getStyles(){let a=await this.apiClient.get("/styles/");if(a.error)throw a.error;return a.data?.styles||[]}async getTags(){let a=await this.apiClient.get("/tags/");if(a.error)throw a.error;return a.data?.tags||[]}async getTopSongs(a){let b=new URLSearchParams;a?.range&&b.set("range",a.range),a?.limit&&b.set("limit",a.limit.toString());let c=await this.apiClient.get(`/top_songs/?${b.toString()}`);if(c.error)throw c.error;return e.fromBackendList(c.data||[])}async getOriginalWorks(){let a=await this.apiClient.get("/original-works/");if(a.error)throw a.error;return e.originalWorkListFromBackend(a.data||[])}async getRandomSong(){let a=await this.apiClient.get("/random-song/");if(a.error)throw a.error;return e.fromBackend(a.data)}async getRecommendation(){let a=await this.apiClient.get("/site-settings/");if(a.error)throw a.error;return e.recommendationFromBackend(a.data)}async getFilterOptions(){let[a,b]=await Promise.all([this.getStyles(),this.getTags()]);return{styles:a,tags:b,languages:["国语","粤语","英语","日语","韩语","其他"]}}};class f{static fromBackend(a){return{id:a.id?.toString()||"",title:a.title||"",description:a.description||"",coverUrl:d(a.cover_url),coverThumbnailUrl:d(a.cover_thumbnail_url||a.cover_url),level:a.level||0,imageCount:a.image_count||0,folderPath:a.folder_path||"",tags:Array.isArray(a.tags)?a.tags:[],isLeaf:a.is_leaf??!0,children:a.children?this.fromBackendList(a.children):void 0,breadcrumbs:a.breadcrumbs?this.breadcrumbsFromBackend(a.breadcrumbs):void 0,createdAt:a.created_at||""}}static fromBackendList(a){return Array.isArray(a)?a.map(a=>this.fromBackend(a)):(console.warn("GalleryMapper.fromBackendList: expected array, got",typeof a),[])}static breadcrumbsFromBackend(a){return Array.isArray(a)?a.map(a=>({id:a.id?.toString()||"",title:a.title||""})):[]}static imageFromBackend(a){return{id:a.id?.toString()||"",url:d(a.url),thumbnailUrl:d(a.thumbnail_url||a.url),title:a.title||"",filename:a.filename||"",isGif:a.is_gif||!1,isVideo:a.is_video||!1}}static imageListFromBackend(a){return Array.isArray(a)?a.map(a=>this.imageFromBackend(a)):(console.warn("GalleryMapper.imageListFromBackend: expected array, got",typeof a),[])}static buildTree(a,b){return b?a.filter(a=>a.breadcrumbs?.some(a=>a.id===b)):a}}let g=new class{apiClient;constructor(a){this.apiClient=a||new c}async getGalleries(a={}){let b=new URLSearchParams;a.parentId&&b.set("parent",a.parentId),a.page&&b.set("page",a.page.toString()),a.limit&&b.set("limit",a.limit.toString());let c=await this.apiClient.get(`/gallery/tree/?${b.toString()}`);if(c.error)throw c.error;return f.fromBackendList(c.data||[])}async getGalleryById(a){let b=await this.apiClient.get(`/gallery/${a}/`);if(b.error)throw b.error;return f.fromBackend(b.data)}async getGalleryImages(a,b){let c=new URLSearchParams;b?.page&&c.set("page",b.page.toString()),b?.page_size&&c.set("page_size",b.page_size.toString());let d=await this.apiClient.get(`/gallery/${a}/images/?${c.toString()}`);if(d.error)throw d.error;let e=d.data;return Array.isArray(e)?{images:f.imageListFromBackend(e),total:e.length}:{images:f.imageListFromBackend(e.images||[]),total:e.total||e.images?.length||0}}async getGalleryBreadcrumbs(a){let b=await this.apiClient.get(`/gallery/${a}/`);if(b.error)throw b.error;return f.fromBackend(b.data).breadcrumbs||[]}async syncGallery(a){let b=await this.apiClient.post(`/gallery/${a}/sync/`,{});return b.error?{success:!1,message:b.error.message||"同步失败"}:{success:!0,message:"同步成功"}}async getChildrenImages(a){let b=await this.apiClient.get(`/gallery/${a}/children-images/`);if(b.error)throw b.error;let c=b.data;return c.images?{children:[{gallery:f.fromBackend(c.gallery),images:f.imageListFromBackend(c.images)}],totalGalleries:1,totalImages:c.total||c.images.length}:{children:(c.children||[]).map(a=>({gallery:f.fromBackend(a.gallery),images:f.imageListFromBackend(a.images||[])})),totalGalleries:c.total_galleries||0,totalImages:c.total_images||0}}};a.s(["galleryRepository",0,g],47686);class h{static fromBackend(a){return{id:a.id?.toString()||"",date:a.date||"",title:a.title||void 0,summary:a.summary||void 0,viewCount:(a.viewCount??a.view_count)?.toString(),danmakuCount:(a.danmakuCount??a.danmaku_count)?.toString(),startTime:a.startTime??a.start_time,endTime:a.endTime??a.end_time,duration:a.duration,bvid:a.bvid,parts:a.parts,coverUrl:d(a.coverUrl??a.cover_url),recordings:a.recordings?this.recordingsFromBackend(a.recordings):void 0,songCuts:this.songCutsFromBackend(a.songCuts??a.song_cuts),screenshots:a.screenshots?this.screenshotsFromBackend(a.screenshots):void 0,danmakuCloudUrl:a.danmakuCloudUrl??a.danmaku_cloud_url}}static fromBackendList(a){return Array.isArray(a)?a.map(a=>this.fromBackend(a)):(console.warn("LivestreamMapper.fromBackendList: expected array, got",typeof a),[])}static recordingsFromBackend(a){return Array.isArray(a)?a.map(a=>({title:a.title||"",url:a.url||""})):[]}static songCutsFromBackend(a){return a&&Array.isArray(a)?a.map(a=>({performed_at:a.performed_at||"",song_name:a.song_name||"",url:a.url||"",coverThumbnailUrl:d(a.coverThumbnailUrl??a.cover_thumbnail_url)})):[]}static screenshotsFromBackend(a){return a&&Array.isArray(a)?a.map(a=>({url:d(a.url),thumbnailUrl:d(a.thumbnailUrl??a.thumbnail_url??a.url)})):[]}static calendarFromBackend(a){return Array.isArray(a)?a.map(a=>({date:a.date||"",hasLivestream:a.has_livestream||!1,livestreamId:a.livestream_id?.toString(),title:a.title})):(console.warn("LivestreamMapper.calendarFromBackend: expected array, got",typeof a),[])}static segmentsFromBackend(a){return Array.isArray(a)?a.map(a=>({part:a.part||1,title:a.title||"",url:a.url||"",duration:a.duration})):[]}static formatDuration(a){if(!a)return"";let b=a.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!b)return a;let c=parseInt(b[1]||"0"),d=parseInt(b[2]||"0"),e=parseInt(b[3]||"0"),f=[];return c>0&&f.push(`${c}小时`),d>0&&f.push(`${d}分钟`),e>0&&0===c&&f.push(`${e}秒`),f.join("")||a}}new class{apiClient;constructor(a){this.apiClient=a||new c}async getLivestreams(a={}){let b=new URLSearchParams;a.page&&b.set("page",a.page.toString()),a.limit&&b.set("limit",a.limit.toString()),a.year&&b.set("year",a.year.toString()),a.month&&b.set("month",a.month.toString());let c=await this.apiClient.get(`/livestreams/?${b.toString()}`);if(c.error)throw c.error;let d=c.data,e=d;return(d&&"object"==typeof d&&"code"in d&&(e=d.data),Array.isArray(e))?{livestreams:h.fromBackendList(e),total:e.length}:{livestreams:h.fromBackendList(e?.results||[]),total:e?.total||e?.results?.length||0}}async getLivestreamById(a){let b=await this.apiClient.get(`/livestreams/${a}/`);if(b.error)throw b.error;let c=b.data?.data||b.data;return h.fromBackend(c)}async getLivestreamByDate(a){let b=await this.apiClient.get(`/livestreams/${a}/`);if(b.error){if(b.error.message?.includes("404"))return null;throw b.error}let c=b.data?.data!==void 0?b.data.data:b.data;return c?h.fromBackend(c):null}async getCalendar(a,b){return(await this.getLivestreams({year:a,month:b})).livestreams.map(a=>({date:a.date,hasLivestream:!0,livestreamId:a.id,title:a.title}))}async getSegments(a){let b=await this.apiClient.get(`/livestreams/${a}/segments/`);return b.error?[]:h.segmentsFromBackend(b.data||[])}async getSongCuts(a){let b=await this.apiClient.get(`/livestreams/${a}/song-cuts/`);return b.error?[]:h.songCutsFromBackend(b.data||[])}async getScreenshots(a){let b=await this.apiClient.get(`/livestreams/${a}/screenshots/`);return b.error?[]:h.screenshotsFromBackend(b.data||[])}async getRecentLivestreams(a=5){let b=await this.apiClient.get(`/livestreams/?limit=${a}&ordering=-date`);if(b.error)throw b.error;let c=b.data?.data!==void 0?b.data.data:b.data;return Array.isArray(c)?h.fromBackendList(c):h.fromBackendList(c?.results||[])}async getConfig(){let a=await this.apiClient.get("/livestreams/config/");if(a.error)return{minYear:2019};let b=a.data?.data!==void 0?a.data.data:a.data;return{minYear:b?.minYear||2019}}};class i{static collectionFromBackend(a){return{id:a.id?.toString()||"",name:a.name||"",description:a.description||"",worksCount:a.works_count||0}}static collectionListFromBackend(a){return Array.isArray(a)?a.map(a=>this.collectionFromBackend(a)):(console.warn("FansDIYMapper.collectionListFromBackend: expected array, got",typeof a),[])}static workFromBackend(a){let b=a.cover||"";return{id:a.id?.toString()||"",title:a.title||"",author:a.author||"",cover:d(b),coverThumbnailUrl:d(a.cover_thumbnail_url||b),videoUrl:a.video_url||"",note:a.note||"",collectionId:a.collection_id?.toString()||"",position:a.position||0}}static workListFromBackend(a){return Array.isArray(a)?a.map(a=>this.workFromBackend(a)):(console.warn("FansDIYMapper.workListFromBackend: expected array, got",typeof a),[])}}new class{apiClient;constructor(a){this.apiClient=a||new c}async getCollections(a={}){let b=new URLSearchParams;a.page&&b.set("page",a.page.toString()),a.limit&&b.set("limit",a.limit.toString());let c=await this.apiClient.get(`/fansDIY/collections/?${b.toString()}`);if(c.error)throw c.error;let d=c.data;return Array.isArray(d)?{collections:i.collectionListFromBackend(d),total:d.length}:{collections:i.collectionListFromBackend(d.results||[]),total:d.total||d.results?.length||0}}async getCollectionById(a){let b=await this.apiClient.get(`/fansDIY/collections/${a}/`);if(b.error)throw b.error;return i.collectionFromBackend(b.data)}async getWorks(a={}){let b=new URLSearchParams;a.page&&b.set("page",a.page.toString()),a.limit&&b.set("limit",a.limit.toString()),a.collection&&b.set("collection",a.collection);let c=await this.apiClient.get(`/fansDIY/works/?${b.toString()}`);if(c.error)throw c.error;let d=c.data;return Array.isArray(d)?{works:i.workListFromBackend(d),total:d.length}:{works:i.workListFromBackend(d.results||[]),total:d.total||d.results?.length||0}}async getWorkById(a){let b=await this.apiClient.get(`/fansDIY/works/${a}/`);if(b.error)throw b.error;return i.workFromBackend(b.data)}async getWorksByCollection(a,b={}){return this.getWorks({...b,collection:a})}};class j{static dataPointFromBackend(a){return{time:a.time||"",value:a.value||0,delta:a.delta||0}}static dataPointListFromBackend(a){return Array.isArray(a)?a.map(a=>this.dataPointFromBackend(a)):[]}static historyFromBackend(a){if(!a||"object"!=typeof a)return{DAY:[],WEEK:[],MONTH:[]};let b={DAY:[],WEEK:[],MONTH:[]};for(let[c,d]of Object.entries(a)){let a=c.toUpperCase();a in b&&(b[a]=this.dataPointListFromBackend(d))}return b}static accountDataFromBackend(a){return{id:a.id?.toString()||"",name:a.name||"",totalFollowers:a.totalFollowers||a.total_followers||0,history:this.historyFromBackend(a.history)}}static accountDataListFromBackend(a){return Array.isArray(a)?a.map(a=>this.accountDataFromBackend(a)):[]}static videoStatsFromBackend(a){let b={DAY:{views:[],likes:[],danmaku:[]},WEEK:{views:[],likes:[],danmaku:[]},MONTH:{views:[],likes:[],danmaku:[]}};if(a.metrics)for(let[c,d]of Object.entries(a.metrics))b[c.toUpperCase()]={views:this.dataPointListFromBackend(d.views||[]),likes:this.dataPointListFromBackend(d.likes||[]),danmaku:this.dataPointListFromBackend(d.danmaku||[])};return{id:a.id?.toString()||"",title:a.title||"",cover:d(a.cover),publishTime:a.publish_time||"",duration:a.duration||"",views:a.views||0,guestRatio:a.guest_ratio||0,fanWatchRate:a.fan_watch_rate||0,followerGrowth:a.follower_growth||0,likes:a.likes||0,comments:a.comments||0,danmaku:a.danmaku||0,favs:a.favs||0,metrics:b}}static videoStatsListFromBackend(a){return Array.isArray(a)?a.map(a=>this.videoStatsFromBackend(a)):(console.warn("AnalyticsMapper.videoStatsListFromBackend: expected array, got",typeof a),[])}static correlationDataFromBackend(a){return{time:a.time||"",videoViewDelta:a.video_view_delta||0,followerDelta:a.follower_delta||0}}static correlationDataListFromBackend(a){return Array.isArray(a)?a.map(a=>this.correlationDataFromBackend(a)):[]}static accountItemFromBackend(a){return{id:a.id?.toString()||"",name:a.name||"",platform:a.platform||""}}static followerOverviewFromBackend(a){return a?{totalFollowers:a.total_followers||0,todayGrowth:a.today_growth||0,weekGrowth:a.week_growth||0,monthGrowth:a.month_growth||0}:{totalFollowers:0,todayGrowth:0,weekGrowth:0,monthGrowth:0}}static formatNumber(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"k":a.toString()}}let k=new class{apiClient;constructor(a){this.apiClient=a||new c}async getAccounts(){let a=await this.apiClient.get("/data-analytics/followers/accounts/");if(a.error)throw a.error;return(a.data||[]).map(a=>j.accountItemFromBackend(a))}async getAllAccountsData(a="WEEK",b=30){let c=new URLSearchParams;c.set("granularity",a),c.set("days",b.toString());let d=await this.apiClient.get(`/data-analytics/followers/accounts/data/?${c.toString()}`);if(d.error)throw d.error;return j.accountDataListFromBackend(d.data||[])}async getAccountData(a){let b=new URLSearchParams;b.set("account_id",a.accountId),a.granularity&&b.set("granularity",a.granularity);let c=30;"DAY"===a.granularity&&(c=720),b.set("days",c.toString()),a.startDate&&b.set("start_date",a.startDate),a.endDate&&b.set("end_date",a.endDate);let d=await this.apiClient.get(`/data-analytics/followers/accounts/${a.accountId}/?${b.toString()}`);if(d.error)throw d.error;return j.accountDataFromBackend(d.data)}async getFollowerOverview(){let a=await this.apiClient.get("/data-analytics/followers/overview/");if(a.error)throw a.error;return j.followerOverviewFromBackend(a.data)}async getVideoStats(a){let b=new URLSearchParams;a.granularity&&b.set("granularity",a.granularity);let c=await this.apiClient.get(`/data-analytics/works/bilibili/${a.videoId}/metrics/?${b.toString()}`);if(c.error)throw c.error;return j.videoStatsFromBackend(c.data)}async getVideos(a){let b=new URLSearchParams;a?.page&&b.set("page",a.page.toString()),a?.limit&&b.set("limit",a.limit.toString()),a?.sortBy&&b.set("sort_by",a.sortBy);let c=await this.apiClient.get(`/data-analytics/works/?${b.toString()}`);if(c.error)throw c.error;let d=c.data;return Array.isArray(d)?{videos:j.videoStatsListFromBackend(d),total:d.length}:{videos:j.videoStatsListFromBackend(d.results||[]),total:d.total||d.results?.length||0}}async getCorrelationData(a){let b=new URLSearchParams;a?.startDate&&b.set("start_date",a.startDate),a?.endDate&&b.set("end_date",a.endDate);let c=await this.apiClient.get(`/data-analytics/platform/bilibili/correlation/?${b.toString()}`);if(c.error)throw c.error;return j.correlationDataListFromBackend(c.data||[])}};a.s(["analyticsRepository",0,k],44321),a.s([],83209)}];

//# sourceMappingURL=app_infrastructure_repositories_index_ts_43118cee._.js.map