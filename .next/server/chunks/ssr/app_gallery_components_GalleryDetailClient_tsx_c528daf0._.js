module.exports=[72563,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(8406),f=a.i(21374),g=a.i(76472),h=a.i(13513),i=a.i(65341);let j=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var k=a.i(21452);a.i(76990);var l=a.i(59110),m=a.i(71987),n=a.i(25015);function o({images:a,onImageClick:c}){return 0===a.length?(0,b.jsx)("div",{className:"text-center py-20",children:(0,b.jsx)("p",{className:"text-[#4a3728]/60",children:"暂无图片"})}):(0,b.jsx)("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4",children:a.map((a,d)=>(0,b.jsx)("button",{onClick:()=>c(a,d),className:"group block w-full break-inside-avoid mb-4",children:(0,b.jsxs)("div",{className:"relative rounded-xl overflow-hidden bg-[#fef5f0] border border-[#8eb69b]/10 hover:border-[#f8b195]/50 hover:shadow-lg hover:shadow-[#f8b195]/10 transition-all duration-300",children:[(0,b.jsxs)("div",{className:"relative",children:[a.isGif||a.isVideo?(0,b.jsx)("img",{src:a.thumbnailUrl||a.url,alt:a.title||a.filename,className:"w-full h-auto object-cover group-hover:scale-105 transition-transform duration-500",loading:"lazy"}):(0,b.jsx)(m.default,{src:a.thumbnailUrl||a.url,alt:a.title||a.filename,width:400,height:300,className:"w-full h-auto object-cover group-hover:scale-105 transition-transform duration-500",sizes:"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"}),a.isVideo&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/30 transition-colors",children:(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,b.jsx)(n.Play,{className:"w-6 h-6 text-[#f67280] fill-[#f67280] ml-0.5"})})})]}),(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-3",children:(0,b.jsx)("span",{className:"text-white text-sm font-medium line-clamp-1",children:a.title||a.filename})}),(a.isGif||a.isVideo)&&(0,b.jsx)("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-[#f67280] rounded text-xs text-white font-medium",children:a.isGif?"GIF":"视频"})]})},a.id))})}var p=a.i(33508),q=a.i(13749),r=a.i(50522),s=a.i(8549),t=a.i(12439),u=a.i(52920);function v({images:a,currentIndex:d,onClose:e,onPrevious:f,onNext:g,onIndexChange:h}){let i=a[d],j=(0,c.useRef)(null),[k,l]=(0,c.useState)(!0),[m,o]=(0,c.useState)(!0),v=(0,c.useCallback)(a=>{switch(a.key){case"Escape":e();break;case"ArrowLeft":f();break;case"ArrowRight":g();break;case" ":a.preventDefault(),i?.isVideo&&j.current&&(j.current.paused?(j.current.play(),l(!0)):(j.current.pause(),l(!1)))}},[e,f,g,i]);if((0,c.useEffect)(()=>(document.addEventListener("keydown",v),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",v),document.body.style.overflow=""}),[v]),(0,c.useEffect)(()=>{l(!0),o(!0)},[d]),!i)return null;let w=i.isVideo,x=i.isGif,y=()=>{j.current&&(j.current.paused?(j.current.play(),l(!0)):(j.current.pause(),l(!1)))};return(0,b.jsxs)("div",{className:"fixed inset-0 z-50 bg-black/95 flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 flex-shrink-0",children:[(0,b.jsxs)("div",{className:"px-3 py-1 rounded-full bg-white/10 text-white text-sm",children:[d+1," / ",a.length,w&&" · 视频",x&&" · GIF"]}),(0,b.jsx)("button",{onClick:e,className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors","aria-label":"关闭",children:(0,b.jsx)(p.X,{className:"w-6 h-6 text-white"})})]}),(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center min-h-0 overflow-hidden",children:(0,b.jsxs)("div",{className:"flex items-center justify-center",children:[a.length>1&&(0,b.jsx)("button",{onClick:f,className:"flex-shrink-0 p-2 md:p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors mr-2","aria-label":"上一张",children:(0,b.jsx)(q.ChevronLeft,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),(0,b.jsx)("div",{className:"relative",children:w?(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("video",{ref:j,src:i.url,className:"max-w-full max-h-[calc(100vh-180px)] object-contain",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onClick:y}),(0,b.jsxs)("div",{className:"mt-3 flex items-center gap-4 px-4 py-2 rounded-full bg-black/60 backdrop-blur-sm",children:[(0,b.jsx)("button",{onClick:y,className:"p-2 rounded-full hover:bg-white/20 transition-colors","aria-label":k?"暂停":"播放",children:k?(0,b.jsx)(s.Pause,{className:"w-5 h-5 text-white"}):(0,b.jsx)(n.Play,{className:"w-5 h-5 text-white"})}),(0,b.jsx)("button",{onClick:()=>{j.current&&(j.current.muted=!j.current.muted,o(!m))},className:"p-2 rounded-full hover:bg-white/20 transition-colors","aria-label":m?"取消静音":"静音",children:m?(0,b.jsx)(u.VolumeX,{className:"w-5 h-5 text-white"}):(0,b.jsx)(t.Volume2,{className:"w-5 h-5 text-white"})}),(0,b.jsx)("span",{className:"text-white text-sm hidden sm:inline",children:"空格键播放/暂停"})]})]}):(0,b.jsx)("img",{src:i.url,alt:i.title||i.filename,className:"max-w-full max-h-[calc(100vh-140px)] object-contain"})}),a.length>1&&(0,b.jsx)("button",{onClick:g,className:"flex-shrink-0 p-2 md:p-3 rounded-full bg-white/10 hover:bg-white/20 transition-colors ml-2","aria-label":"下一张",children:(0,b.jsx)(r.ChevronRight,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})})]})}),a.length>1&&(0,b.jsx)("div",{className:"px-4 py-3 flex-shrink-0",children:(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto max-w-full mx-auto p-2 rounded-xl bg-black/50 backdrop-blur-sm justify-center",children:a.map((a,c)=>(0,b.jsxs)("button",{onClick:()=>h(c),className:`relative flex-shrink-0 w-14 h-14 md:w-16 md:h-16 rounded-lg overflow-hidden border-2 transition-all ${c===d?"border-[#f8b195] scale-110":"border-transparent opacity-60 hover:opacity-100"}`,children:[(0,b.jsx)("img",{src:a.thumbnailUrl||a.url,alt:a.title||a.filename,className:"w-full h-full object-cover"}),(a.isVideo||a.isGif)&&(0,b.jsx)("div",{className:"absolute top-0.5 right-0.5 px-1 py-0.5 bg-[#f67280] rounded text-[8px] text-white font-medium leading-none",children:a.isVideo?"视频":"GIF"})]},a.id))})})]})}var w=a.i(92596),x=a.i(79165);function y({galleries:a,onGalleryClick:c}){return 0===a.length?(0,b.jsx)("div",{className:"text-center py-20",children:(0,b.jsx)("p",{className:"text-[#4a3728]/60",children:"暂无图集"})}):(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(a=>(0,b.jsxs)("button",{onClick:()=>c(a),className:"group relative bg-white rounded-2xl overflow-hidden shadow-sm border border-[#8eb69b]/10 hover:border-[#f8b195]/50 hover:shadow-lg hover:shadow-[#f8b195]/10 transition-all duration-300 text-left",children:[(0,b.jsxs)("div",{className:"aspect-[4/3] relative bg-gradient-to-br from-[#fef5f0] to-[#f8b195]/10",children:[a.coverUrl?(0,b.jsx)(m.default,{src:a.coverThumbnailUrl||a.coverUrl,alt:a.title,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-500",sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 25vw"}):(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)(w.Folder,{className:"w-16 h-16 text-[#8eb69b]/30"})}),(0,b.jsxs)("div",{className:"absolute top-3 right-3 px-2 py-1 bg-black/50 backdrop-blur-sm rounded-full flex items-center gap-1",children:[(0,b.jsx)(x.ImageIcon,{className:"w-3 h-3 text-white"}),(0,b.jsx)("span",{className:"text-xs text-white font-medium",children:a.imageCount})]})]}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("h3",{className:"font-bold text-[#4a3728] group-hover:text-[#f8b195] transition-colors line-clamp-1",children:a.title}),a.description&&(0,b.jsx)("p",{className:"mt-1 text-sm text-[#4a3728]/60 line-clamp-2",children:a.description})]})]},a.id))})}function z({childrenGroups:a,allChildrenImages:c,onImageClick:d}){return 0===a.length?(0,b.jsx)("div",{className:"text-center py-20",children:(0,b.jsx)("p",{className:"text-[#4a3728]/60",children:"暂无图片"})}):(0,b.jsx)("div",{className:"space-y-12",children:a.map(a=>(0,b.jsxs)("section",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-[#4a3728]",children:a.gallery.title}),(0,b.jsxs)("span",{className:"px-2 py-0.5 bg-[#8eb69b]/20 rounded-full text-xs text-[#8eb69b] font-medium",children:[a.images.length," 张"]})]}),(0,b.jsx)("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-4 space-y-4",children:a.images.map(a=>{let e=c.findIndex(b=>b.id===a.id);return(0,b.jsx)("button",{onClick:()=>d(a,e,c),className:"group block w-full break-inside-avoid mb-4",children:(0,b.jsxs)("div",{className:"relative rounded-xl overflow-hidden bg-[#fef5f0] border border-[#8eb69b]/10 hover:border-[#f8b195]/50 hover:shadow-lg hover:shadow-[#f8b195]/10 transition-all duration-300",children:[(0,b.jsxs)("div",{className:"relative",children:[a.isGif||a.isVideo?(0,b.jsx)("img",{src:a.thumbnailUrl||a.url,alt:a.title||a.filename,className:"w-full h-auto object-cover group-hover:scale-105 transition-transform duration-500",loading:"lazy"}):(0,b.jsx)(m.default,{src:a.thumbnailUrl||a.url,alt:a.title||a.filename,width:400,height:300,className:"w-full h-auto object-cover group-hover:scale-105 transition-transform duration-500",sizes:"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"}),a.isVideo&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/30 transition-colors",children:(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,b.jsx)(n.Play,{className:"w-6 h-6 text-[#f67280] fill-[#f67280] ml-0.5"})})})]}),(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-3",children:(0,b.jsx)("span",{className:"text-white text-sm font-medium line-clamp-1",children:a.title||a.filename})}),(a.isGif||a.isVideo)&&(0,b.jsx)("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-[#f67280] rounded text-xs text-white font-medium",children:a.isGif?"GIF":"视频"})]})},a.id)})})]},a.gallery.id))})}function A({galleryId:a}){let m=(0,d.useRouter)(),[n,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,w]=(0,c.useState)([]),[x,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(0),[H,I]=(0,c.useState)("grid");(0,c.useEffect)(()=>{(async()=>{C(!0);try{let b=await l.galleryRepository.getGalleryById(a);if(p(b),b.children&&0!==b.children.length){let c=b.children||[];if(t(c),c.every(a=>a.isLeaf))try{let b=(await l.galleryRepository.getChildrenImages(a)).children||[];w(b);let c=b.flatMap(a=>a.images);A(c),I("children")}catch(a){console.error("Failed to load children images:",a),I("grid")}else I("grid")}else{let b=await l.galleryRepository.getGalleryImages(a);r(b.images),I("images")}}catch(a){console.error("Failed to load gallery:",a)}finally{C(!1)}})()},[a]);let J=(a,b,c)=>{E(a),G(b),c&&c.length>0&&A(c)},K="children"===H?x.length:"images"===H?q.length:n?.imageCount||0;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.PageDecorations,{theme:"gallery"}),(0,b.jsxs)("div",{className:"fixed inset-0 pointer-events-none overflow-hidden -z-5",children:[(0,b.jsx)("div",{className:"absolute top-20 left-10 animate-bounce",style:{animationDuration:"3s"},children:(0,b.jsx)(f.Star,{className:"w-6 h-6 text-yellow-400/40"})}),(0,b.jsx)("div",{className:"absolute top-32 left-24 animate-pulse",style:{animationDelay:"0.4s"},children:(0,b.jsx)(e.Sparkles,{className:"w-5 h-5 text-[#f8b195]/40"})}),(0,b.jsx)("div",{className:"absolute top-24 right-16 animate-spin",style:{animationDuration:"4s"},children:(0,b.jsx)(i.Sun,{className:"w-8 h-8 text-orange-300/30"})}),(0,b.jsx)("div",{className:"absolute top-40 right-8 animate-pulse",style:{animationDelay:"0.6s"},children:(0,b.jsx)(g.Heart,{className:"w-5 h-5 text-[#f67280]/30 fill-[#f67280]/30"})}),(0,b.jsx)("div",{className:"absolute bottom-40 right-16 animate-bounce",style:{animationDuration:"3.5s",animationDelay:"0.5s"},children:(0,b.jsx)(h.Camera,{className:"w-6 h-6 text-[#8eb69b]/30"})}),(0,b.jsx)("div",{className:"absolute bottom-32 left-20 animate-pulse",style:{animationDelay:"0.8s"},children:(0,b.jsx)(e.Sparkles,{className:"w-5 h-5 text-pink-300/30"})})]}),(0,b.jsxs)("div",{className:"min-h-screen bg-[#fef5f0] p-6",children:[(0,b.jsx)("div",{className:"max-w-7xl mx-auto mb-6",children:(0,b.jsxs)("button",{onClick:()=>m.push("/gallery"),className:"flex items-center gap-2 text-[#8eb69b] hover:text-[#f8b195] transition-colors font-bold",children:[(0,b.jsx)(j,{size:20}),(0,b.jsx)("span",{children:"返回图集"})]})}),n&&(0,b.jsxs)("div",{className:"max-w-7xl mx-auto mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl md:text-4xl font-black text-[#4a3728] mb-2",children:n.title}),n.description&&(0,b.jsx)("p",{className:"text-[#8eb69b] font-bold",children:n.description}),(0,b.jsxs)("p",{className:"text-sm text-[#8eb69b]/70 mt-2",children:["共 ",K," 张图片","children"===H&&s.length>0&&(0,b.jsxs)("span",{className:"ml-2",children:["（来自 ",s.length," 个子图集）"]})]})]}),B&&(0,b.jsxs)("div",{className:"py-48 flex flex-col items-center gap-6",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-8 border-[#f8b195]/20 border-t-[#f8b195] rounded-full animate-spin"}),(0,b.jsx)("span",{className:"text-[#8eb69b] font-black tracking-widest uppercase text-xs",children:"正在加载..."})]}),!B&&"images"===H&&q.length>0&&(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsx)(o,{images:q,onImageClick:(a,b)=>J(a,b,q)})}),!B&&"children"===H&&u.length>0&&(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsx)(z,{childrenGroups:u,allChildrenImages:x,onImageClick:J})}),!B&&"grid"===H&&s.length>0&&(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsx)(y,{galleries:s,onGalleryClick:a=>{m.push(`/gallery/${a.id}`)}})}),!B&&"images"===H&&0===q.length&&(0,b.jsx)("div",{className:"py-48 text-center",children:(0,b.jsx)("p",{className:"text-[#8eb69b] font-bold",children:"暂无图片"})})]}),D&&(0,b.jsx)(v,{images:x.length>0?x:q,currentIndex:F,onClose:()=>E(null),onPrevious:()=>{let a=x.length>0?x:q;F>0&&(G(F-1),E(a[F-1]))},onNext:()=>{let a=x.length>0?x:q;F<a.length-1&&(G(F+1),E(a[F+1]))},onIndexChange:G,onSelectImage:E})]})}a.s(["default",()=>A],72563)}];

//# sourceMappingURL=app_gallery_components_GalleryDetailClient_tsx_c528daf0._.js.map